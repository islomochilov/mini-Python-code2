
adminlar   = {}
kitoblar   = []
userlar    = {}
aktiv_user = None  

def _pause():
    input("\nâ†©ï¸Ž  Enter bosing davom etish uchun...")

def _input_int(prompt):
    while True:
        s = input(prompt)
        try:
            return int(s)
        except ValueError:
            print("â—ï¸ Butun son kiriting.")

def user_kitoblar_royxati():
    if not kitoblar:
        print("â›”ï¸ Hozircha hech qanday kitob yoâ€˜q.")
        return user_menu()

    print("\nðŸ“š Kitoblar ro'yxati:")
    print("-" * 60)
    for k in kitoblar:
        print(f"ID: {k['id']:>3} | Nomi: {k['nomi']:<25} | "
              f"Muallif: {k['author']:<15} | Narxi: {k['narxi']} so'm")
    _pause()
    user_menu()

def user_kitob_search():
    if not kitoblar:
        print("â›”ï¸ Hozircha hech qanday kitob yoâ€˜q.")
        return user_menu()

    q = input("Qidirayotgan nom/muallif yoki ID: ").strip().lower()
    if not q:
        print("â—ï¸ Boâ€˜sh qidiruv soâ€˜zi kiritildi.")
        return user_menu()

    natija = [k for k in kitoblar if
              q in k['nomi'].lower()
              or q in k['author'].lower()
              or q == k['id'].lower()]

    if natija:
        print(f"\nðŸ”Ž {len(natija)} ta kitob topildi:")
        print("-" * 60)
        for k in natija:
            print(f"ID: {k['id']:>3} | Nomi: {k['nomi']:<25} | "
                  f"Muallif: {k['author']:<15} | Narxi: {k['narxi']} so'm")
    else:
        print("âŒ Hech narsa topilmadi.")
    _pause()
    user_menu()

def user_kitob_detail_va_xarid():
    if not kitoblar:
        print("â›”ï¸ Hozircha hech qanday kitob yoâ€˜q.")
        return user_menu()

    id_ = input("Kitob ID sini kiriting: ").strip()
    for k in kitoblar:
        if k['id'] == id_:
            print(f"""
ðŸ“– Kitob haqida
ID      : {k['id']}
Nomi    : {k['nomi']}
Muallif : {k['author']}
Narxi   : {k['narxi']} so'm
""")
            if input("Sotib olasizmi? [ha/yo'q]: ").lower() == "ha":
                balans = userlar[aktiv_user]['balans']
                if balans >= k['narxi']:
                    userlar[aktiv_user]['balans']   -= k['narxi']
                    userlar[aktiv_user]['xaridlar'].append(k)
                    print("âœ… Xarid amalga oshirildi!")
                    print(f"ðŸ’³ Yangi balans: {userlar[aktiv_user]['balans']} so'm")
                else:
                    print("âŒ Balansingiz yetarli emas.")
            break
    else:
        print("âŒ Bunday ID topilmadi.")
    _pause()
    user_menu()

def user_balans():
    balans = userlar[aktiv_user]['balans']
    print(f"\nðŸ’³ Joriy balans: {balans} so'm")
    if input("Balansni toâ€˜ldirasizmi? [ha/yo'q]: ").lower() == "ha":
        summa = _input_int("Toâ€˜ldirish summasi: ")
        if summa > 0:
            userlar[aktiv_user]['balans'] += summa
            print("âœ… Balans toâ€˜ldirildi.")
            print(f"ðŸŸ¢ Yangi balans: {userlar[aktiv_user]['balans']} so'm")
    _pause()
    user_menu()

def user_xaridlar():
    xaridlar = userlar[aktiv_user]['xaridlar']
    if not xaridlar:
        print("ðŸ“­ Hali hech qanday xarid qilmagansiz.")
    else:
        print("\nðŸ›’ Xarid qilingan kitoblar:")
        print("-" * 50)
        for i, k in enumerate(xaridlar, 1):
            print(f"{i}. {k['nomi']} | {k['author']} | {k['narxi']} so'm")
    _pause()
    user_menu()

def user_menu():
    print(f"\nðŸ“˜ USER PANEL ({aktiv_user})")
    print("""
 1. Kitoblar ro'yhati
 2. Kitob search
 3. Kitob detail va sotib olish
 4. Balans
 5. Xaridlar
 6. Ortga
""")
    tanlov = input("Tanlovni kiriting: ")
    if   tanlov == "1": user_kitoblar_royxati()
    elif tanlov == "2": user_kitob_search()
    elif tanlov == "3": user_kitob_detail_va_xarid()
    elif tanlov == "4": user_balans()
    elif tanlov == "5": user_xaridlar()
    elif tanlov == "6": asosiy_menu()
    else:
        print("âŒ Notoâ€˜gâ€˜ri tanlov!")
        user_menu()

def user_registration():
    while True:
        login = input("ðŸ†• Login tanlang: ").strip()
        if login in userlar:
            print("Bu login band.")
            continue
        parol = input("Parol: ").strip()
        userlar[login] = {"parol": parol, "balans": 0, "xaridlar": []}
        global aktiv_user
        aktiv_user = login
        print("âœ… Roâ€˜yxatdan oâ€˜tdingiz!")
        user_menu()
        break

def user_panel():
    login = input("Login: ").strip()
    parol = input("Parol: ").strip()
    if login in userlar and userlar[login]["parol"] == parol:
        global aktiv_user
        aktiv_user = login
        print(f"âœ… Xush kelibsiz, {login}!")
        user_menu()
    else:
        print("âŒ Login/parol xato yoki mavjud emas â€” roâ€˜yxatdan oâ€˜tasiz.")
        user_registration()


def admin_registration():
    login = input("Yangi admin login: ").strip()
    if login in adminlar:
        print("Bu login band.")
        return admin_menu()
    parol = input("Parol: ").strip()
    adminlar[login] = parol
    print("âœ… Admin roâ€˜yxatdan oâ€˜tdi.")
    admin_menu()

def kitob_qoshish():
    id_ = input("Kitob ID: ").strip()
    nomi = input("Nomi: ").strip()
    author = input("Muallif: ").strip()
    narxi  = _input_int("Narxi (soâ€˜m): ")
    kitoblar.append({'id': id_, 'nomi': nomi, 'author': author, 'narxi': narxi})
    print("âœ… Kitob qoâ€˜shildi.")
    if input("Yana kitob qoâ€˜shasizmi? [ha/yo'q]: ").lower() == "ha":
        kitob_qoshish()
    else:
        admin_menu()

def kitob_tahrirlash():
    id_ = input("Tahrirlanadigan kitob ID: ").strip()
    for k in kitoblar:
        if k['id'] == id_:
            print(f"Joriy: {k['id']} | {k['nomi']} | {k['author']} | {k['narxi']}")
            k['nomi']   = input("Yangi nom (boâ€˜sh qoldirsangiz oâ€˜zgarmaydi): ") or k['nomi']
            k['author'] = input("Yangi muallif: ") or k['author']
            narx = input("Yangi narx: ")
            k['narxi'] = int(narx) if narx else k['narxi']
            print("âœ… Yangilandi.")
            break
    else:
        print("âŒ Bunday ID topilmadi.")
    admin_menu()

def kitob_ochirish():
    if not kitoblar:
        print("â›”ï¸ Kitoblar roâ€˜yxati boâ€˜sh.")
        return admin_menu()
    id_ = input("Oâ€˜chiriladigan kitob ID: ").strip()
    for k in kitoblar:
        if k['id'] == id_:
            kitoblar.remove(k)
            print("âœ… Kitob oâ€˜chirildi.")
            break
    else:
        print("âŒ Bunday ID topilmadi.")
    admin_menu()

def kitob_detail():
    id_ = input("Koâ€˜rmoqchi boâ€˜lgan kitob ID: ").strip()
    for k in kitoblar:
        if k['id'] == id_:
            print(f"""
ID    : {k['id']}
Nomi  : {k['nomi']}
Muallif: {k['author']}
Narxi : {k['narxi']} so'm
""")
            break
    else:
        print("âŒ Bunday ID topilmadi.")
    _pause()
    admin_menu()

def kitoblar_royxati():
    if not kitoblar:
        print("â›”ï¸ Kitoblar yoâ€˜q.")
        return admin_menu()
    print("\nðŸ“š Barcha kitoblar:")
    print("-" * 60)
    for k in kitoblar:
        print(f"{k['id']:>3} | {k['nomi']:<25} | {k['author']:<15} | {k['narxi']} so'm")
    _pause()
    admin_menu()

def kitob_search():
    q = input("Qidiruv (nom/muallif/ID): ").lower()
    natija = [k for k in kitoblar if
              q in k['nomi'].lower() or
              q in k['author'].lower() or
              q == k['id'].lower()]
    if natija:
        for k in natija:
            print(f"- {k['id']} | {k['nomi']} | {k['author']} | {k['narxi']} so'm")
    else:
        print("âŒ Topilmadi.")
    _pause()
    admin_menu()

def admin_menu():
    print("""
======= ADMIN MENU =======
 1  â€“ Kitob qoâ€˜shish
 2  â€“ Kitob tahrirlash
 3  â€“ Kitob oâ€˜chirish
 4  â€“ Kitob detail
 5  â€“ Kitoblar roâ€˜yhatini koâ€˜rish
 6  â€“ Kitob qidirish
 7  â€“ Ortga (asosiy menu)
""")
    tanlov = input("Tanlov: ")
    if   tanlov == "1": kitob_qoshish()
    elif tanlov == "2": kitob_tahrirlash()
    elif tanlov == "3": kitob_ochirish()
    elif tanlov == "4": kitob_detail()
    elif tanlov == "5": kitoblar_royxati()
    elif tanlov == "6": kitob_search()
    elif tanlov == "7": asosiy_menu()
    else:
        print("Notoâ€˜gâ€˜ri tanlov!")
        admin_menu()

def admin_panel():
    login = input("Admin login: ").strip()
    parol = input("Parol: ").strip()
    if adminlar.get(login) == parol:
        print("âœ… Admin tasdiqlandi.")
        admin_menu()
    else:
        print("âŒ Login/parol xato.")
        if input("Roâ€˜yxatdan oâ€˜tasizmi? [ha/yo'q]: ").lower() == "ha":
            admin_registration()
        else:
            asosiy_menu()

def asosiy_menu():
    print("""
======= ASOSIY MENU ======
 1 â€“ Admin panel
 2 â€“ User panel
 3 â€“ Dasturdan chiqish
""")
    tanlov = input("Tanlov: ")
    if   tanlov == "1": admin_panel()
    elif tanlov == "2": user_panel()
    elif tanlov == "3":
        print("Dasturdan chiqdingiz.")
        exit()
    else:
        print("Notoâ€˜gâ€˜ri tanlov!")
        asosiy_menu()

if __name__ == "__main__":
    asosiy_menu()
